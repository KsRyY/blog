<!DOCTYPE html>
<html>
  <head>
  <title>
      
          构建一个本地rust crates镜像 - Konomo Blog
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="map[]" />
  <link rel="shortcut icon" type="image/x-icon" href="https://konomo.now.sh/img/favicon.ico">

  
  
  
  
  
  <link rel="stylesheet" href="https://konomo.now.sh/style.min.a6cab246517742ad1189b209575fc61556550e663cdfe02a0aab0632b39e978b.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  

  
  <link rel="stylesheet" href="https://unpkg.com/prismjs/themes/prism.css">

  <meta property="og:title" content="构建一个本地rust crates镜像" />
<meta property="og:description" content="众所周知, rust的官方包管理器源在国内有点小问题, 轻则下载速度缓慢, 重则连接超时, 而唯一在国内提供rust crates镜像源的中科大源也时" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://konomo.now.sh/blog/cargo-local-mirror/" />
<meta property="article:published_time" content="2019-08-15T11:35:45+08:00" />
<meta property="article:modified_time" content="2019-08-15T11:35:45+08:00" />
<meta itemprop="name" content="构建一个本地rust crates镜像">
<meta itemprop="description" content="众所周知, rust的官方包管理器源在国内有点小问题, 轻则下载速度缓慢, 重则连接超时, 而唯一在国内提供rust crates镜像源的中科大源也时">


<meta itemprop="datePublished" content="2019-08-15T11:35:45&#43;08:00" />
<meta itemprop="dateModified" content="2019-08-15T11:35:45&#43;08:00" />
<meta itemprop="wordCount" content="615">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="构建一个本地rust crates镜像"/>
<meta name="twitter:description" content="众所周知, rust的官方包管理器源在国内有点小问题, 轻则下载速度缓慢, 重则连接超时, 而唯一在国内提供rust crates镜像源的中科大源也时"/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  
  <script src="https://unpkg.com/prismjs/prism.js"></script>
  <script src="https://unpkg.com/prismjs/components.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-bash.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-json.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-toml.min.js"></script>
</head>

  <body>
    
  <h1>构建一个本地rust crates镜像</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://konomo.now.sh/img/avatar.jpg">
    <a href="https://konomo.now.sh"><img src="https://konomo.now.sh/img/avatar-border.svg"></a>
  </div>
  
  <h2><a class="author" href="https://konomo.now.sh">Konomo</a></h2>
</header>

  
  
  <p class="date">August 15, 2019</p>
  
  <div id="contentBody">
    

<p>众所周知, rust的官方包管理器源在国内有点小问题, 轻则下载速度缓慢, 重则连接超时, 而唯一在国内提供rust crates镜像源的中科大源也时常挂掉, 所以你也许需要构建一个本地源以备不时之需.</p>

<h2 id="搭建步骤">搭建步骤</h2>

<ol>
<li><p>将github上的rust crates官方镜像源克隆到本地(目前大小100MB多, 还可以接受)</p>

<pre><code class="language-bash">git clone https://github.com/rust/crates.io-index.git
</code></pre></li>

<li><p>切换到本地目录</p>

<pre><code class="language-bash">cd crates.io-index
</code></pre></li>

<li><p>打开这个目录下的<code>config.json</code>文件, 然后将其替换为以下内容:</p>

<pre><code class="language-json">{
&quot;dl&quot;: &quot;https://crates-io.proxy.ustclug.org/api/v1/crates&quot;,
&quot;api&quot;: &quot;https://crates.io/&quot;
}
</code></pre>

<p><em>这边用了中科大搭的一个rust crates API反向代理, 这玩意实测可用</em></p></li>

<li><p>这样镜像本身就搭建好了</p></li>
</ol>

<p><em>注: 这个镜像更新速度贼快, 而且拉取一般情况下耗时不会太长, 所以你可以没事就<code>git pull origin</code>拉一下</em></p>

<h2 id="配置cargo">配置cargo</h2>

<p>接下来就轮到配置cargo了, 将以下内容写入你的<code>~/.cargo/config</code>文件中(此处路径为使用rustup安装的默认路径):</p>

<pre><code class="language-toml">[source.crates-io]
replace-with = 'local'
[source.local]
registry = &quot;file://这儿替换成你的镜像目录的绝对路径&quot;
</code></pre>

<p>如果你配置过中科大源, 那你的配置文件应该看上去像这样:</p>

<pre><code class="language-toml">[source.crates-io]
replace-with = 'ustc'
[source.ustc]
registry = &quot;https://mirrors.ustc.edu.cn/crates.io-index&quot;
</code></pre>

<p>在<code>source.ustc</code>项下面加一行 <code>replace-with = 'local'</code>
然后把下面的东西粘贴到文件末尾就行了:</p>

<pre><code class="language-toml">[source.local]
registry = &quot;file://这儿替换成你的镜像目录的绝对路径&quot;
</code></pre>

<h2 id="附-关于windows下镜像目录的url">附: 关于Windows下镜像目录的URL</h2>

<p>如果Windows下你的镜像目录的绝对路径是<code>C:/crates.io-index</code>, 那么镜像目录的URL是<code>file:///C:/crates.io-index</code></p>

  </div>
  <footer>
  <p>
  &copy; 2019 Konomo.
  Powered by <a href="https://gohugo.io/">Hugo</a>
  using the <a href="https://github.com/koirand/pulp/">pulp</a> theme.
  </p>
</footer>


  </body>
</html>
